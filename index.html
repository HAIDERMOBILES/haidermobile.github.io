<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCYzkMGDwWZGx_PlrNfjloYZ6PVQRne9wg",
        authDomain: "web-app-4f3a1.firebaseapp.com",
        projectId: "web-app-4f3a1",
        databaseURL: "https://web-app-4f3a1-default-rtdb.firebaseio.com", 
        storageBucket: "web-app-4f3a1.firebasestorage.app",
        messagingSenderId: "222099203820",
        appId: "1:222099203820:web:778e204d2960181dfba7c9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const mobileWrapper = document.getElementById('mobile-wrapper');
    const accessoryWrapper = document.getElementById('accessory-wrapper');

    // Real-time listener for ALL products
    onValue(ref(db, 'products'), (snapshot) => {
        if (!snapshot.exists()) {
            mobileWrapper.innerHTML = "<p style='text-align:center; padding:50px;'>No data found in 'products' node.</p>";
            return;
        }

        const data = snapshot.val();
        
        // Containers ko pehle khali karein
        mobileWrapper.innerHTML = `<div class="brand-section"><div class="main-title">Smart<span>phones</span></div><div class="product-container" id="mob-grid"></div></div>`;
        accessoryWrapper.innerHTML = `<div class="brand-section"><div class="main-title">Premium<span>Accessories</span></div><div class="product-container" id="acc-grid"></div></div>`;
        
        const mobGrid = document.getElementById('mob-grid');
        const accGrid = document.getElementById('acc-grid');

        Object.keys(data).forEach(key => {
            const p = data[key];
            const cardHTML = `
                <div class="card">
                    <img src="${p.img || 'https://via.placeholder.com/200'}" onerror="this.src='https://via.placeholder.com/200'">
                    <h3>${p.name || 'Unnamed Product'}</h3>
                    <span class="price">Rs. ${p.price || '0'}</span>
                    <div class="btn-group">
                        <a href="product.html?id=${key}" class="btn-view">VIEW DETAILS</a>
                        <a href="https://wa.me/923279518790?text=I want to buy ${p.name}" class="btn-wa">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </div>
                </div>
            `;

            // Agar category Accessory hai toh wahan bhejain, warna Mobile mein
            if (p.category === 'Accessory') {
                accGrid.innerHTML += cardHTML;
            } else {
                mobGrid.innerHTML += cardHTML;
            }
        });
    });

    // Search function fix
    document.getElementById('search').addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll('.card').forEach(card => {
            const title = card.querySelector('h3').innerText.toLowerCase();
            card.style.display = title.includes(val) ? "block" : "none";
        });
    });
</script>
